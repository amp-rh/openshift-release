chain:
  as: interop-tests-fusion-access-ebs-integration-chain
  steps:
  - ref: storage-create-aws-extra-disks
  - ref: interop-tests-fusion-access-create-local-disks
  - ref: interop-tests-fusion-access-create-ebs-filesystem
  - ref: interop-tests-fusion-access-verify-cluster
  - ref: interop-tests-fusion-access-verify-operator
  - ref: interop-tests-fusion-access-verify-ebs-filesystem
  - ref: interop-tests-fusion-access-diagnose-init-containers
  env:
  - name: NODE_ROLE
    default: "worker"
    documentation: The role of nodes to attach EBS volumes to
  - name: EXTRA_DISKS_COUNT
    default: "3"
    documentation: Number of EBS volumes to create per worker node for IBM Storage Scale
  - name: EXTRA_DISKS_TYPE
    default: "gp3"
    documentation: EBS volume type for IBM Storage Scale storage
  - name: EXTRA_DISKS_SIZE
    default: "100"
    documentation: Size in GiB for each EBS volume
  documentation: |-
    EBS integration chain for Fusion Access testing with EBS filesystem.
    
    This chain provides the EBS-specific components for Fusion Access testing:
    - EBS volume creation: Creates and attaches 3x100GB gp3 EBS volumes per worker node
    - LocalDisk creation: Creates LocalDisk resources (for Filesystem references)
    - Filesystem creation: Creates IBM Storage Scale filesystem using LocalDisk references
    - Cluster verification: Validates IBM Storage Scale cluster (operator-created) and daemon pods (8 tests)
    - Operator verification: Validates operator behavior and quorum detection (5 tests)
    - Filesystem verification: Validates filesystem status and LocalDisk status (6 tests)
    - Init container diagnostics: Deep analysis of init container failures (5 tests)
    
    Enhanced Verification Features:
    - Distinguishes root cause (mmbuildgpl failures) from symptoms (missing secrets, no quorum)
    - Provides detailed error messages with actionable recommendations
    - Reports version compatibility information for troubleshooting
    - Validates operator reconciliation logic is working correctly
    
    Note: The Cluster resource is created automatically by the FusionAccess operator
    via device discovery, not manually configured in this chain.
        
    This chain should be used after the shared deployment chain to complete
    the EBS-based Fusion Access deployment and testing.
    
    Prerequisites:
    - Shared deployment chain must complete successfully
    - IBM Storage Scale cluster must be ready
    - AWS cluster with worker nodes (using EBS volumes for storage)
